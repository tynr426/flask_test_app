var HPFX;(function(n){var i,t,r;(function(n){n[n.TopLeft=0]="TopLeft";n[n.TopCenter=1]="TopCenter";n[n.TopRight=2]="TopRight";n[n.MiddleLeft=3]="MiddleLeft";n[n.MiddleCenter=4]="MiddleCenter";n[n.MiddleRight=5]="MiddleRight";n[n.BottomLeft=6]="BottomLeft";n[n.BottomCenter=7]="BottomCenter";n[n.BottomRight=8]="BottomRight"})(n.HPFXAnchorPoint||(n.HPFXAnchorPoint={}));i=n.HPFXAnchorPoint,function(n){n[n.TopLeft=0]="TopLeft";n[n.TopRight=1]="TopRight";n[n.BottomLeft=2]="BottomLeft";n[n.BottomRight=3]="BottomRight"}(n.HPFXOriginPoint||(n.HPFXOriginPoint={}));t=n.HPFXOriginPoint;r=function(){function r(n,t,i,r,u,f,e,o,s,h){this.x=null;this.y=null;this.anchorPoint=null;this.originPoint=null;this.adjustToImage=!1;this.maxWidth=null;this.maxHeight=null;this.childOf=null;this.isFirstChild=!1;this.isInlineBlock=!1;n!=null&&(this.x=n);t!=null&&(this.y=t);i!=null&&(this.anchorPoint=i);r!=null&&(this.originPoint=r);u!=null&&(this.adjustToImage=u);f!=null&&(this.maxWidth=f);e!=null&&(this.maxHeight=e);o!=null&&(this.childOf=o);s!=null&&(this.isFirstChild=s);h!=null&&(this.isInlineBlock=h)}r.RecalculatePositions=function(){var i=0,f=n.Header?r.PixelsToInt(getComputedStyle(n.Header).height):0,t,u;i+=f;this.ImageTopLeft=r.PageCoordinates("0px",r.IntToPixels(i));this.ImageTopCenter=r.PageCoordinates("50%",r.IntToPixels(i),1);this.ImageTopRight=r.PageCoordinates("0px",r.IntToPixels(i),2,1);t=0;u=n.Controls?r.PixelsToInt(getComputedStyle(n.Controls).height):0;
//! TODO: This will likely break when used with Vertical Scroll. Will sync w/ Jason to resolve.
var e=n.Carousel?r.PixelsToInt(getComputedStyle(n.Carousel).height):0,o=n.Footer?r.PixelsToInt(getComputedStyle(n.Footer).height):0,s=_ge(n.EZPanelId)?r.PixelsToInt(getComputedStyle(_ge(n.EZPanelId)).height):0;t+=o;t+=s;t+=e;this.CarouselTopLeft=r.PageCoordinates("0px",r.IntToPixels(t+u),6,2);this.CarouselTopCenter=r.PageCoordinates("50%",r.IntToPixels(t),7,2);this.CarouselTopRight=r.PageCoordinates("0px",r.IntToPixels(t+u),8,3)};r.PixelsToInt=function(n){if(n.indexOf("px")<0)return null;try{return n=n.replace("px",""),parseInt(n)}catch(t){return null}};r.IntToPixels=function(n){return n+"px"};r.PageCoordinates=function(n,t,i,u){return i||(i=0),u||(u=0),new r(n,t,i,u,!1,null,null,null,null,null)};
//! TODO: Only support px values as coordinates
//! TODO: Use w and h (el dimension for max img resolution) to optionally scale the element with the image
//! TODO: Use MiddleCenter for best results with zoom
return r.ImageCoordinates=function(n,t,i,u,f,e){return f||(f=0),e||(e=0),new r(n,t,f,e,!0,i,u,null,null,null)},r.AsChild=function(n,t,i){return t==null&&(t=!1),i==null&&(i=!1),new r(null,null,null,null,null,null,null,n,t,i)},r.prototype.apply=function(n){var i,t,r;n&&(this.resetPosition(n),this.x!=null&&this.y!=null&&this.anchorPoint!=null&&this.originPoint!=null&&(i=this.getCssProperties(),t=this.getAdjustedCoordinate(n),n.style.position="absolute",t.x!=null&&(n.style[i.x]=t.x),t.y!=null&&(n.style[i.y]=t.y)),this.childOf!=null&&this.isFirstChild!=null&&this.isInlineBlock!=null&&(n.style.display=this.isInlineBlock?"inline-block":"block",r=this.childOf.children,r.length>0&&this.isFirstChild?this.childOf.insertBefore(n,r[0]):this.childOf.appendChild(n)))},r.prototype.resetPosition=function(n){n&&(n.style.position="",n.style.top="",n.style.left="",n.style.right="",n.style.bottom="")},r.prototype.getCssProperties=function(){var n={x:null,y:null},i=t[this.originPoint];return n.x=i.indexOf("Left")>-1?"left":"right",n.y=i.indexOf("Top")>-1?"top":"bottom",n},r.prototype.getAdjustedCoordinate=function(u){var c,l,o,s,y,rt,ut,ft,k,e;if(u){if(c=null,l=null,this.adjustToImage){
//! TODO: Refactor to avoid code duplication (Birthday -> HPFX or shared fn)
var d=getComputedStyle(n.ImageContainer),a=n.ImageMaxWidth,v=n.ImageMaxHeight,g=n.ImageContainer.clientHeight,nt=n.ImageContainer.clientWidth,tt=r.PixelsToInt(this.x),it=r.PixelsToInt(this.y);tt!=null&&it!=null&&(y=a/v,rt=nt/a<g/v,rt?(o=g,s=y*o):(s=nt,o=s/y),c=tt*(s/a)+r.PixelsToInt(d.left),l=it*(o/v)+r.PixelsToInt(d.top),this.maxWidth&&this.maxHeight&&(ut=this.maxWidth*(s/a),u.style.width=r.IntToPixels(ut),ft=this.maxHeight*(o/v),u.style.height=r.IntToPixels(ft)))}var p={x:null,y:null},et=getComputedStyle(u),w=r.PixelsToInt(et.width),b=r.PixelsToInt(et.height),f=i[this.anchorPoint],ot=t[this.originPoint],st=ot.indexOf("Top")>-1,ht=ot.indexOf("Left")>-1,ct=c!=null?r.IntToPixels(c):this.x,h=0;return f.indexOf("Left")>-1&&!ht?h+=w:f.indexOf("Center")>-1?h+=w/2:f.indexOf("Right")>-1&&ht&&(h+=w),p.x=h===0?ct:"calc("+ct+" - "+r.IntToPixels(h)+")",k=l!=null?r.IntToPixels(l):this.y,e=0,f.indexOf("Top")>-1&&!st?e+=b:f.indexOf("Middle")>-1?e+=b/2:f.indexOf("Bottom")>-1&&st&&(e+=b),p.y=e===0?k:"calc("+k+" - "+r.IntToPixels(e)+")",p}},r.WithMediaButtons=r.AsChild(_ge("sh_rdiv"),!0),r.UnderSearchBox=r.AsChild(_ge("sbox")),r.MobileAboveCards=r.AsChild(_ge("hc_overflow"),!0),r.ImageTopLeft=r.PageCoordinates("0px","43px"),r.ImageTopCenter=r.PageCoordinates("50%","43px",1),r.ImageTopRight=r.PageCoordinates("0px","43px",2,1),r.CarouselTopLeft=r.PageCoordinates("0px","182px",6,2),r.CarouselTopCenter=r.PageCoordinates("50%","146px",7,2),r.CarouselTopRight=r.PageCoordinates("0px","194px",8,3),r.PageCenter=r.PageCoordinates("50%","50%",4),r}();n.HPFXPosition=r})(HPFX||(HPFX={})),function(n){var t=function(){function n(n,t,i){this.thens=[];this.delay=n;t&&this.then(t);i&&this.start()}return n.prototype.start=function(){var n=this;this.timeoutHandle=sb_st(function(){n.execute()},this.delay)},n.prototype.stop=function(){this.timeoutHandle&&(sb_ct(this.timeoutHandle),this.timeoutHandle=null)},n.prototype.then=function(n){this.thens.push(n)},n.prototype.execute=function(){for(var n=0;n<this.thens.length;++n)this.thens[n]()},n}();n.HPFXTimer=t}(HPFX||(HPFX={})),function(n){(function(n){n[n.Image=0]="Image";n[n.Video=1]="Video";n[n.Audio=2]="Audio"})(n.HPFXContentType||(n.HPFXContentType={}));var i=n.HPFXContentType,t=function(){function n(n,t,i,r,u,f,e){this.type=n;this.src=t;i!=null&&(this.title=i);r!=null&&(this.credit=r);u!=null&&(this.href=u);f!=null&&(this.shouldLoop=f);e!=null&&(this.shouldAutoplay=e)}return n.Image=function(t,i,r,u){return new n(0,t,i,r,u,null,null)},n.Video=function(t,i,r,u,f,e){return new n(1,t,u,f,e,i,r)},n.Audio=function(t,i,r,u,f){return new n(2,t,u,f,null,i,r)},n.prototype.getInfoButtonAlt=function(){return this.title&&this.credit?""+this.title+" ("+this.credit+")":null},n}();n.HPFXContent=t}(HPFX||(HPFX={})),function(n){var t=function(){function n(n){this.element=n}return n.prototype.show=function(t,i,r){this.hideTimeout&&(sb_ct(this.hideTimeout),this.hideTimeout=null);t||this.element.style.opacity==""&&this.element.style.filter==""||(this.element.style.opacity="",this.element.style.filter="");this.element.style.visibility="visible";t>0&&(this.prepareToAnimate(t,n.FadeProperty,n.EasingFunction),sj_so(this.element,i||100));this.isHidden=!1;r&&(t?sb_st(r,t):r())},n.prototype.hide=function(t,i){var r=this;t||this.element.style.opacity==""&&this.element.style.filter==""||(this.element.style.opacity="",this.element.style.filter="");t>0&&(this.prepareToAnimate(t,n.FadeProperty,n.EasingFunction),sj_so(this.element,0));t>0?(this.hideTimeout&&(sb_ct(this.hideTimeout),this.hideTimeout=null),this.hideTimeout=sb_st(function(){r.element.style.visibility="hidden"},t)):this.element.style.visibility="hidden";this.isHidden=!0;i&&(t?sb_st(i,t):i())},n.prototype.toggle=function(n,t){this.isHidden?this.show(n,null,t):this.hide(n,t)},n.prototype.move=function(t,i){if(i>0){
//! TODO: So far, will animate only when using same properties (eg left,top)
this.prepareToAnimate(i,["left","top","right","bottom"],n.EasingFunction)}this.position=t;t.apply(this.element)},n.prototype.text=function(n){return n&&(this.element.textContent=n),this.element.textContent},n.prototype.hasClass=function(n){return this.element.classList?this.element.classList.contains(n):new RegExp("(^| )"+n+"( |$)","gi").test(this.element.className)},n.prototype.addClass=function(t,i,r){i>0&&this.prepareToAnimate(n.DefaultProperty,i,n.EasingFunction);this.hasClass(t)||(this.element.classList?this.element.classList.add(t):this.element.className+=" "+t);r&&(i?sb_st(r,i):r())},n.prototype.removeClass=function(t,i,r){i>0&&this.prepareToAnimate(n.DefaultProperty,i,n.EasingFunction);this.element.classList?this.element.classList.remove(t):this.element.className=this.element.className.replace(new RegExp("(^|\\b)"+t.split(" ").join("|")+"(\\b|$)","gi")," ");r&&(i?sb_st(r,i):r())},n.prototype.toggleClass=function(n,t,i){this.hasClass(n)?this.removeClass(n,t,i):this.addClass(n,t,i)},n.prototype.onClick=function(n){this.setInteractable();sj_be(this.element,"click",n);sj_be(this.element,"keydown",function(t){var i=t.which||t.keyCode;i==13&&n()})},n.prototype.onHover=function(n){this.setInteractable();sj_be(this.element,"mouseover",n);sj_be(this.element,"focus",n)},n.prototype.on=function(n,t){sj_be(this.element,n,t)},n.prototype.onBlur=function(n){this.setInteractable();sj_be(this.element,"mouseout",n);sj_be(this.element,"blur",n)},n.prototype.play=function(){if(this.element instanceof HTMLMediaElement){var n=this.element;n.play()}},n.prototype.pause=function(){if(this.element instanceof HTMLMediaElement){var n=this.element;n.pause()}},n.prototype.stop=function(){if(this.element instanceof HTMLMediaElement){var n=this.element;n.pause();n.currentTime=0}},n.prototype.volume=function(n){if(this.element instanceof HTMLMediaElement){var t=this.element;return n!=null&&(t.volume=n),t.volume}return 0},n.prototype.log=function(n){var i,t=this.element.id;if(t&&t.length>0)i=t+"_"+n;else throw"Element must have an id in order to be able to use .log()";_w.Log&&Log.Log&&Log.Log("DHTMLClick","HPFX",i)},n.prototype.setInteractable=function(){var n=this;this.isInteractable||(this.isInteractable=!0,this.element.tabIndex=0,this.element.style.cursor="pointer",sj_be(this.element,"mousedown",function(){n.element.style.outline="none"}),sj_be(this.element,"keydown",function(){
//! TODO: Doesn't work on first tab if clicked immediately before (rare case)
n.element.style.outline=""}))},n.prototype.prepareToAnimate=function(t,i,r){var u,f;if(r||(r=n.EasingFunction),i||(i=n.DefaultProperty),i instanceof Array)for(this.element.style.transition="",u=0;u<i.length;++u)this.element.style.transition+=""+i+" "+t+"ms "+r,u<i.length-1&&(this.element.style.transition+=", ");else this.element.style.transition=""+i+" "+t+"ms "+r;this.isAnimating=!0;this.animationTimeout&&(sb_ct(this.animationTimeout),this.animationTimeout=null);f=this;this.animationTimeout=sb_st(function(){f.element.style.transition="none";f.isAnimating=!1},t+1)},n.EasingFunction="ease-in-out",n.FadeProperty="opacity",n.DefaultProperty="all",n}();n.HPFXElement=t}(HPFX||(HPFX={})),function(n){var t=function(){
//! TODO: Implement set date ranges (as an option)
function t(t,i,r){this.name="";this.currentDate=null;this.urlParameter=null;this.elements=[];this.originalImage=null;this.swappedImage=null;this.originalVideo=null;this.swappedVideo=null;this.originalAudio=null;this.swappedAudio=null;this.fadeDelay=500;this.imageFader=n.IsMobile?null:_anim.fadeE(n.ImageContainer,this.fadeDelay);this.name=t;this.currentDate=i||this.dateToString(new Date);this.urlParameter=r;this.bindToResize();this.bindToImageViewer();this.bindToHPQS();this.bindToCarousel();this.bindToEZPanel()}t.prototype.addElement=function(t,i,r,u,f){var o=sj_ce(t,i,r),e=new n.HPFXElement(o);return e.hide(),n.Container.appendChild(o),this.elements.push(e),u!=null&&(e.move(u),f||e.show()),e};t.prototype.addMedia=function(n,t,i,r,u){var e,o,f;return n.type===0?e="img":n.type===1?e="video":n.type===2&&(e="audio"),o=this.addElement(e,t,i,r,u),f=o.element,f.src=n.src,n.shouldAutoplay!=null&&(f.autoplay=!0,f.play()),n.shouldLoop!=null&&(f.loop=!0),o};t.prototype.getElement=function(t){var r=_ge(t),i;return r?(i=new n.HPFXElement(r),this.elements.push(i),i):null};t.prototype.hideAllElements=function(){for(var n=0;n<this.elements.length;++n)this.elements[n].element.style.display="none"};t.prototype.showAllElements=function(){for(var t,i,n=0;n<this.elements.length;++n)t=this.elements[n],i=t.position?t.position.isInlineBlock:!1,t.element.style.display=i?"inline-block":"block"};t.prototype.afterDelay=function(t,i){return new n.HPFXTimer(t,i,!0)};t.prototype.after=function(t,i,r){var u=new n.HPFXTimer(i,r);return t.then(function(){u.start()}),u};
//! TODO: Add social icons as a default option here (instead of text labels)
t.prototype.bootstrapSharing=function(t){var r=this,i,u,f,e;t||(t=n.HPFXPosition.ImageTopRight);i=this.addElement("div","hpfx_sharecont","",n.HPFXPosition.ImageTopRight);u=this.addElement("div","hpfx_fbshare","hpfx_share",n.HPFXPosition.AsChild(i.element,!1,!0));u.text("F");u.onClick(function(){r.shareFacebook()});f=this.addElement("div","hpfx_twshare","hpfx_share",n.HPFXPosition.AsChild(i.element,!1,!0));f.text("T");f.onClick(function(){r.shareTwitter()});e=this.addElement("div","hpfx_skshare","hpfx_share",n.HPFXPosition.AsChild(i.element,!1,!0));e.text("S");e.onClick(function(){r.shareSkype()});return i};
//! TODO: Follow-up: sync w/ Hongtao once sharing JS API is ready to reuse that code
t.prototype.shareFacebook=function(t,i,r,u,f,e){var s,o,h;t&&t.length!==0||(t=this.defaultSharingLink(n.ShareFacebook.formCode));e&&e.length!==0||(s=_w.location.href.toLowerCase().indexOf("https://")>-1?"https://":"http://",e=s+"bing.com/share/fbre?t=hpfx");o=n.ShareFacebook.baseURL;o+="&link="+encodeURIComponent(t);o+="&redirect_uri="+encodeURIComponent(e);i&&i.length>0&&(o+="&picture="+encodeURIComponent(i));r&&r.length>0&&(o+="&name="+encodeURIComponent(r));u&&u.length>0&&(o+="&description="+encodeURIComponent(u));f&&f.length>0&&(o+="&caption="+encodeURIComponent(f));h=_w.open(o,n.ShareTarget,n.ShareFacebook.options)};
//! TODO: Follow-up: sync w/ Hongtao once sharing JS API is ready to reuse that code
t.prototype.shareTwitter=function(t,i,r){var u,f;t&&t.length!==0||(t=this.defaultSharingLink(n.ShareTwitter.formCode));r&&r.length!==0||(r="https://bing.com");i||(i="");u=n.ShareTwitter.baseURL;u+="&text="+encodeURIComponent(i)+"%20"+encodeURIComponent(t);u+="&original_referer="+encodeURIComponent(r);f=_w.open(u,n.ShareTarget,n.ShareTwitter.options)};
//! TODO: Follow-up: sync w/ Hongtao once sharing JS API is ready to reuse that code
t.prototype.shareSkype=function(t){var i,r;t&&t.length!==0||(t=this.defaultSharingLink(n.ShareSkype.formCode));i=n.ShareSkype.baseURL;i+="&url="+encodeURIComponent(t);r=_w.open(i,n.ShareTarget,n.ShareSkype.options)};t.prototype.isLoadedFromParameter=function(){return n.UrlParameter&&this.urlParameter&&n.UrlParameter===this.urlParameter};t.prototype.isEnabledToday=function(){var n=this.dateToString(new Date),t=this.currentDate.split("_")[0];return n.indexOf(t)>-1};t.prototype.swapImage=function(n,t,i){this.originalImage||(this.originalImage=this.getImage());
//! TODO: Replace 0 constant with dynamically calculated one
_w.hp_overrideImg&&hp_overrideImg(0,!0);t?this.fadeImage(n,i):this.setImage(n,!1,i);this.swappedImage=n};t.prototype.restoreImage=function(n,t){if(this.originalImage){n?this.fadeImage(this.originalImage,t):this.setImage(this.originalImage,!1,t);this.swappedImage=null;
//! TODO: Replace 0 constant with dynamically calculated one
_w.hp_overrideImg&&hp_overrideImg(0,!1)}};t.prototype.swapVideo=function(n,t,i){this.originalVideo||(this.originalVideo=this.getVideo());
//! TODO: Replace 0 constant with dynamically calculated one
_w.hp_overrideImg&&hp_overrideImg(0,!0);t?this.fadeVideo(n,i):this.setVideo(n,!1,i);this.swappedVideo=n};t.prototype.restoreVideo=function(n,t){if(this.originalVideo){n?this.fadeVideo(this.originalVideo,t):this.setVideo(this.originalVideo,!1,t);this.swappedVideo=null;
//! TODO: Replace 0 constant with dynamically calculated one
_w.hp_overrideImg&&hp_overrideImg(0,!1)}};
//! TODO: Not ready yet - see comments in setAudio(...) below. Use app.addMedia(...) to add new audio assets.
t.prototype.swapAudio=function(n,t){this.originalAudio||(this.originalAudio=this.getAudio());this.setAudio(n,t);this.swappedAudio=n};t.prototype.restoreAudio=function(n){this.originalAudio&&(this.setAudio(this.originalAudio,n),this.swappedAudio=null)};t.prototype.setMuseumCard=function(t,i,r){if(n.MuseumCard.Title&&t&&(n.MuseumCard.Title.textContent=t),n.MuseumCard.Credit&&i&&(n.MuseumCard.Credit.textContent=i),r&&(n.MuseumCard.Link&&(n.MuseumCard.Link.href=r),n.MuseumCard.InfoButton&&(n.MuseumCard.InfoButton.href=r)),n.MuseumCard.InfoButton&&t&&i){var u=""+t+" ("+i+")";n.MuseumCard.InfoButton.setAttribute("alt",u)}};t.prototype.hideImageOverlays=function(){for(var i,t=0;t<n.ImageOverlayIds.length;++t)i=_ge(n.ImageOverlayIds[t]),i&&(i.style.display="none")};t.prototype.showImageOverlays=function(){for(var i,t=0;t<n.ImageOverlayIds.length;++t)i=_ge(n.ImageOverlayIds[t]),i&&(i.style.display="block")};t.prototype.hideNativeSharing=function(){n.ImageFavorites&&(n.ImageFavorites.style.display="none");n.ImageSharing&&(n.ImageSharing.style.display="none");n.ImageActionLinks&&(n.ImageActionLinks.style.display="none");var t=_ge(n.MobileSharingId);t&&(t.style.display="none",n.MobileCaption.classList.remove("with_actions"))};t.prototype.showNativeSharing=function(){n.ImageFavorites&&(n.ImageFavorites.style.display="block");n.ImageSharing&&(n.ImageSharing.style.display="block");n.ImageActionLinks&&(n.ImageActionLinks.style.display="block");var t=_ge(n.MobileSharingId);t&&(t.style.display="block",n.MobileCaption.classList.add("with_actions"))};t.prototype.hideCarousel=function(){n.Carousel&&(n.Carousel.style.display="none");var t=_ge(n.CarouselTabsId);t&&(t.style.display="none")};t.prototype.showCarousel=function(){n.Carousel&&(n.Carousel.style.display="block");var t=_ge(n.CarouselTabsId);t&&(t.style.display="block")};t.prototype.hideEZPanel=function(){var t=_ge(n.EZPanelId);t&&(t.style.display="none")};t.prototype.showEZPanel=function(){var t=_ge(n.EZPanelId);t&&(t.style.display="block")};
//! TODO: Needs to be tested
t.prototype.preLoadMedia=function(n){var t;n.type===0?t=sj_ce("img"):n.type===1?t=sj_ce("video"):n.type===2&&(t=sj_ce("audio"));t.src=n.src;n.type!==0&&(t.preload="auto",t.muted=!0,t.volume=0)};t.prototype.pauseAllMedia=function(){for(var r,u,t=_d.getElementsByTagName("audio"),i=_d.getElementsByTagName("video"),n=0;n<t.length;++n)r=t[n],r.pause();for(n=0;n<i.length;++n)u=i[n],u.pause()};t.prototype.resumeAllMedia=function(){for(var r,u,t=_d.getElementsByTagName("audio"),i=_d.getElementsByTagName("video"),n=0;n<t.length;++n)r=t[n],r.play();for(n=0;n<i.length;++n)u=i[n],u.play()};t.prototype.log=function(n){var t=this.name+"_"+n;_w.Log&&Log.Log&&Log.Log("DHTMLClick","HPFX",t)};t.prototype.bindToResize=function(){var n=this;sj_be(_w,"resize",function(){for(var t,i=0;i<n.elements.length;++i)t=n.elements[i],t.position&&t.position.adjustToImage&&t.move(t.position)})};t.prototype.bindToImageViewer=function(){var n=this,t=this;sj_evt.bind("updateHpImg",function(i){var u;if(!(i.length<3)&&(u=i[2],u==="nav")){var f=i[1],r=f.fullstartdate.slice(0,8)+"_"+f.fullstartdate.slice(8),e=n.dateToString(n.addDays(n.stringToDate(r),1)),o=n.dateToString(n.toUTC(new Date)),s=!1;if(s=n.isLoadedFromParameter()?o>=r&&o<=e:n.currentDate>=r&&n.currentDate<=e,s){
//! TODO: Iron out minor annoyances
n.swappedImage&&n.fadeImage(n.swappedImage);n.swappedVideo&&n.fadeVideo(n.swappedVideo);n.swappedAudio&&n.setAudio(n.swappedAudio);t.showAllElements();
//! TODO: This logic could be done better (wrt avoiding race condition with ImgViewer)                
sb_st(function(){sj_evt.fire("onHPFXShowing")},n.fadeDelay)}else{t.pauseAllMedia();t.hideAllElements();t.showNativeSharing();t.showCarousel();t.showEZPanel();t.showImageOverlays();
//! TODO: This logic could be done better (wrt avoiding race condition with ImgViewer)         
sb_st(function(){sj_evt.fire("onHPFXHiding")},n.fadeDelay)}}})};t.prototype.bindToHPQS=function(){sj_evt.bind("onHPQSUpdated",function(){n.HPFXPosition.RecalculatePositions()})};t.prototype.bindToCarousel=function(){sj_evt.bind("CARO_CHNG_STATE",function(){n.HPFXPosition.RecalculatePositions()});sj_evt.bind("CARO_INIT_STATE",function(){n.HPFXPosition.RecalculatePositions()})};t.prototype.bindToEZPanel=function(){sj_evt.bind("ezpOpened",function(){n.HPFXPosition.RecalculatePositions()});sj_evt.bind("ezpHidden",function(){n.HPFXPosition.RecalculatePositions()})};t.prototype.padLeft=function(n,t){for(var i=String(n);i.length<t;)i="0"+i;return i};t.prototype.dateToString=function(n){var t=this.padLeft(n.getFullYear(),4),i=this.padLeft(n.getMonth()+1,2),r=this.padLeft(n.getDate(),2),u=this.padLeft(n.getHours(),2),f=this.padLeft(n.getMinutes(),2);return""+t+i+r+"_"+u+f};t.prototype.stringToDate=function(n){var t=new Date;try{var i=parseInt(n.slice(0,4)),r=parseInt(n.slice(4,6)),u=parseInt(n.slice(6,8)),f=parseInt(n.slice(9,11)),e=parseInt(n.slice(11,13));t.setFullYear(i);t.setMonth(r-1);t.setDate(u);t.setHours(f);t.setMinutes(e)}catch(o){return null}return t};t.prototype.toUTC=function(n){return new Date(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate(),n.getUTCHours(),n.getUTCMinutes(),n.getUTCSeconds())};t.prototype.addDays=function(n,t){var i=new Date(n.valueOf());return i.setDate(i.getDate()+t),i};t.prototype.getImage=function(){var t=getComputedStyle(n.ImageContainer).backgroundImage,i=n.MuseumCard.Title.textContent,r=n.MuseumCard.Credit.textContent,u=n.MuseumCard.Link.href,f=t.replace('url("',"").replace('")',"");return new n.HPFXContent(0,f,i,r,u)};t.prototype.getVideo=function(){if(!n.VideoContainer)return null;var t=n.VideoContainer.src;return new n.HPFXContent(1,t)};t.prototype.getAudio=function(){if(!n.AudioContainer)return null;var r=n.AudioContainer.src,t=null,i=null;return n.MuseumCard.AudioTitle&&n.MuseumCard.AudioCredit&&(t=n.MuseumCard.AudioTitle.textContent,i=n.MuseumCard.AudioCredit.textContent),new n.HPFXContent(2,r,t,i)};t.prototype.setImage=function(t,i,r){var f,u;n.ImageContainer&&(i||(n.ImageContainer.style.opacity="1"),n.VideoContainer.paused||(sj_so(n.VideoContainer,0),n.VideoContainer.style.display="none",VM.pause(),VM.hideControls()),f='url("'+t.src+'")',n.ImageContainer.style.backgroundImage=f,t.title&&(n.MuseumCard.Title.textContent=t.title),t.credit&&(n.MuseumCard.Credit.textContent=t.credit),t.href&&(n.MuseumCard.Link.href=t.href,n.MuseumCard.InfoButton.href=t.href),u=t.getInfoButtonAlt(),u&&n.MuseumCard.InfoButton.setAttribute("alt",u),r&&r())};t.prototype.fadeImage=function(n,t){var i=this;this.imageFader.down(function(){i.setImage(n,!0,function(){t&&t();i.imageFader.up()})})};t.prototype.setVideo=function(t,i,r){var u,f;n.VideoContainer&&(n.VideoContainer.src=t.src,t.shouldAutoplay&&(n.VideoContainer.autoplay=!0,VM.play()),t.shouldLoop&&(n.VideoContainer.loop=!0),t.title&&(n.MuseumCard.Title.textContent=t.title),t.credit&&(n.MuseumCard.Credit.textContent=t.credit),t.href&&(n.MuseumCard.Link.href=t.href,n.MuseumCard.InfoButton.href=t.href),u=t.getInfoButtonAlt(),u&&n.MuseumCard.InfoButton.setAttribute("alt",u),f=function(){n.VideoContainer.style.display="block";sj_so(n.VideoContainer,100);r&&r();sj_ue(n.VideoContainer,"canplaythrough",f)},sj_be(n.VideoContainer,"canplaythrough",f))};
//! TODO: Original video flashes briefly as the overloaded one is loading
//! TODO: Sometimes causes the state where video is playing but player is hidden
return t.prototype.fadeVideo=function(n,t){var i=this;this.imageFader.down(function(){i.setVideo(n,!0,function(){t&&t();i.imageFader.up()})})},t.prototype.setAudio=function(t,i){var r=n.AudioContainer;r||(r=this.addMedia(t,"audioMain").element);r.src=t.src;
//! TODO: Add audio control button if missing
t.shouldAutoplay&&(r.autoplay=!0);t.shouldLoop&&(r.loop=!0);
//! TODO: Doesn't work if audio wasn't loaded already
t.title&&(n.MuseumCard.AudioTitle.textContent=t.title);t.credit&&(n.MuseumCard.AudioCredit.textContent=t.credit);i&&i()},t.prototype.defaultSharingLink=function(t){var i="https://bing.com/?",r;return n.ShareSsd&&(i+="&ssd="+encodeURIComponent(n.ShareSsd)),n.ShareHpms&&(i+="&hpms="+encodeURIComponent(n.ShareHpms)),r=_G.Mkt,r&&r.length>0&&(i+="&mkt="+encodeURIComponent(r)),t&&t.length>0&&(i+="&FORM="+encodeURIComponent(t)),i},t}();n.HPFXApp=t}(HPFX||(HPFX={})),function(n){function t(t,i,r){return new n.HPFXApp(t,i,r)}function i(){sj_evt.bind("EVT_TB_START",n.HPFXPosition.RecalculatePositions);n.Loaded=!0;sj_evt.fire("onHPFXReady")}function r(n){var t=RegExp("[?&]"+n+"=([^&]*)").exec(window.location.search);return t&&decodeURIComponent(t[1].replace(/\+/g," "))}n.Loaded=!1;n.Debug=!1;n.IsMobile=_H.cards===1;n.UrlParameter=r("a");n.Container=n.IsMobile?_ge("hc_overflow"):_ge("hp_container");n.ImageContainer=_ge("bgDiv");n.VideoContainer=_ge("vid");n.AudioContainer=_ge("audioElm");n.AudioButton=_ge("audioMain");n.AudioButtonClass=_ge("audioCont");n.Header=_ge("hp_sw_hdr");n.Carousel=_ge("hp_tbar");n.Controls=_ge("hp_ctrls");n.VideoPauseButton=_ge("sh_ps");n.VideoPlayButton=_ge("sh_pl");n.ImageFavorites=_ge("hp_fav");n.ImageSharing=_ge("hp_share_options");n.ImageActionLinks=_ge("musCardActionLinks");n.Footer=_ge("sb_foot");n.MobileCaption=_ge("hc_caption");n.MuseumCard={Title:_ge("musCardImageTitle"),Credit:_ge("musCardCopyright"),Link:_ge("musCardImageLink"),InfoButton:_ge("sh_cp"),LeftNav:_ge("sh_igl"),RightNav:_ge("sh_igr"),AudioTitle:_ge("hp_audio_info")?_ge("hp_audio_info").getElementsByClassName("audio_caption")[0]:null,AudioCredit:_ge("hp_audio_info")?_ge("hp_audio_info").getElementsByClassName("credit")[0]:null};n.ImageOverlayIds=["hp_trivia","sc_hst1","sc_hst2","sc_hst3","audioNotif"];n.EZPanelId="ezp_panel";n.CarouselTabsId="carouselControls";n.MobileSharingId="hc_imgactions";n.ShareFacebook={baseURL:"https://www.facebook.com/dialog/feed?app_id=111239619098",options:"toolbar=yes, scrollbars=yes, resizable=yes, top=500, left=500, width=550, height=420",formCode:"HPFXFB"};n.ShareTwitter={baseURL:"https://twitter.com/intent/tweet?source=tweetbutton",options:"toolbar=yes, scrollbars=yes, resizable=yes, top=500, left=500, width=550, height=420",formCode:"HPFXTW"};n.ShareSkype={baseURL:"https://web.skype.com/share?",options:"toolbar=no, scrollbars=yes, resizable=yes, top=100, left=500, width=305, height=665",formCode:"HPFXSK"};n.ShareTarget="_blank";n.ShareSsd=_w.hpl?_w.hpl.ssd:null;n.ShareHpms=_w.hpl?_w.hpl.hpms:null;n.ImageMaxHeight=1080;n.ImageMaxWidth=1920;n.createApp=t;sj_evt.bind("onRBComplete",i)}(HPFX||(HPFX={}));
//! TODO:
